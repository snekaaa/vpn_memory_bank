# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VPN Memory Bank

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è VPN Memory Bank –ø—Ä–æ–µ–∫—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pytest –∏ Allure –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install pytest pytest-asyncio pytest-cov allure-pytest
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
pytest tests/

# –ò–ª–∏ –∏–∑ –ø–∞–ø–∫–∏ tests
cd tests && pytest
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ integration/           # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_hello.py     # Health checks –∏ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_payments.py  # –¢–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_webhooks.py  # –¢–µ—Å—Ç—ã webhook'–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ test_e2e_user_journey.py  # E2E —Ç–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ test_user_dashboard.py    # –¢–µ—Å—Ç—ã dashboard
‚îÇ   ‚îú‚îÄ‚îÄ test_app_settings.py      # –¢–µ—Å—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ test_full_cycle.py        # –¢–µ—Å—Ç—ã –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ allure-results/       # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã Allure —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ htmlcov/             # HTML –æ—Ç—á–µ—Ç—ã coverage
‚îú‚îÄ‚îÄ conftest.py          # –§–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ pytest.ini          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ coverage.ini         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è coverage
‚îî‚îÄ‚îÄ README.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **critical** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **integration** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- **e2e** - End-to-end —Ç–µ—Å—Ç—ã
- **mock** - –¢–µ—Å—Ç—ã —Å –º–æ–∫-–¥–∞–Ω–Ω—ã–º–∏
- **slow** - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –ü–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **payment** - –¢–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π
- **webhook** - –¢–µ—Å—Ç—ã webhook'–æ–≤
- **dashboard** - –¢–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **api** - –¢–µ—Å—Ç—ã API

## üéØ –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –ü–æ –º–∞—Ä–∫–µ—Ä–∞–º

```bash
# –¢–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
pytest -m critical

# –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m integration

# –ò—Å–∫–ª—é—á–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"

# –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
pytest -m "critical and not slow"
```

### –ü–æ —Ñ–∞–π–ª–∞–º

```bash
# –¢–µ—Å—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π
pytest tests/integration/test_payments.py

# –¢–µ—Å—Ç—ã webhook'–æ–≤
pytest tests/integration/test_webhooks.py

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/integration/test_hello.py::test_basic_health_check
```

### –ü–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "payment" –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
pytest -k "payment"

# –í—Å–µ —Ç–µ—Å—Ç—ã webhook'–æ–≤
pytest -k "webhook"

# –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
pytest -k "robokassa"
```

## üìà Coverage –æ—Ç—á–µ—Ç—ã

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤

```bash
# HTML –æ—Ç—á–µ—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤)
pytest --cov=. --cov-report=html

# XML –æ—Ç—á–µ—Ç –¥–ª—è CI/CD
pytest --cov=. --cov-report=xml

# –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
pytest --cov=. --cov-report=term-missing
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä HTML –æ—Ç—á–µ—Ç–∞

```bash
# –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –æ—Ç–∫—Ä–æ–π—Ç–µ
open tests/htmlcov/index.html
```

## üìã Allure –æ—Ç—á–µ—Ç—ã

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Allure –æ—Ç—á–µ—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π Allure –¥–∞–Ω–Ω—ã—Ö
pytest --alluredir=tests/allure-results

# –ó–∞–ø—É—Å–∫ Allure —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–æ–≤
allure serve tests/allure-results
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Allure (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# macOS
brew install allure

# Linux
sudo apt-get install allure

# Windows
scoop install allure
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### pytest.ini
- –ú–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è coverage
- –§–∏–ª—å—Ç—Ä—ã –¥–ª—è warnings

### coverage.ini
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
- HTML –∏ XML –æ—Ç—á–µ—Ç—ã
- –ü–æ—Ä–æ–≥–∏ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞

### conftest.py
- –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üö¶ CI/CD Integration

### GitHub Actions –ø—Ä–∏–º–µ—Ä

```yaml
- name: Run tests
  run: |
    pytest tests/ --cov=. --cov-report=xml --alluredir=allure-results

- name: Upload coverage to Codecov
  uses: codecov/codecov-action@v1
  with:
    file: tests/coverage.xml
```

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è

- **Coverage**: –º–∏–Ω–∏–º—É–º 80%
- **Critical —Ç–µ—Å—Ç—ã**: –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤—Å–µ
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –≤—Å–µ —Ç–µ—Å—Ç—ã < 2 –º–∏–Ω—É—Ç—ã

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥

```bash
# –î–µ—Ç–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫
pytest -vvv tests/

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
pytest -x tests/

# –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤
pytest --lf
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å
pytest -s --log-cli-level=DEBUG
```

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –®–∞–±–ª–æ–Ω —Ç–µ—Å—Ç–∞

```python
import pytest
import allure

@allure.epic("Feature Name")
@allure.feature("Specific Feature")
@pytest.mark.critical
@pytest.mark.integration
async def test_something():
    with allure.step("Description of step"):
        # Test implementation
        assert True
        
        allure.attach(
            "Test data",
            name="Test Result",
            attachment_type=allure.attachment_type.TEXT
        )
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä

```python
def test_with_fixtures(sample_user_data, sample_payment_data):
    user = sample_user_data
    payment = sample_payment_data
    
    assert user["telegram_id"] > 0
    assert payment["amount"] > 0
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è

```python
@pytest.mark.parametrize("provider,expected_url", [
    ("robokassa", "https://robokassa.ru"),
    ("freekassa", "https://freekassa.ru")
])
def test_payment_providers(provider, expected_url):
    assert expected_url in get_provider_url(provider)
```

## ü§ù –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤
2. **–ò–∑–æ–ª—è—Ü–∏—è**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
3. **–ê—Å—Å–µ—Ä—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ assert —Å–æ–æ–±—â–µ–Ω–∏—è
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –î–æ–±–∞–≤–ª—è–π—Ç–µ docstrings –∫ —Ç–µ—Å—Ç–∞–º
5. **–ú–∞—Ä–∫–µ—Ä—ã**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç—ã
6. **–§–∏–∫—Å—Ç—É—Ä—ã**: –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ
7. **–ê–ª–ª—é—Ä**: –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—Ç–µ–ø—ã –∏ –∞—Ç—Ç–∞—á–º–µ–Ω—Ç—ã –¥–ª—è –ª—É—á—à–µ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

## üÜò –ü–æ–º–æ—â—å

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—É—Ç–µ–π
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —Ç–µ—Å—Ç–æ–≤
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é pytest.ini

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.