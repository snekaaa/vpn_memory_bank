{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2"><i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a href="/admin/countries" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                        </a>
                    </div>
                </div>
            </div>

            {% if error %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}

            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-globe"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–µ
                    </h5>
                </div>
                <div class="card-body">
                    <form action="/admin/countries/create" method="post">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="code" class="form-label">–ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã *</label>
                                    <input type="text" class="form-control" id="code" name="code" 
                                           maxlength="2" pattern="[A-Z]{2}" required
                                           placeholder="RU, US, DE, FR..."
                                           style="text-transform: uppercase;">
                                    <div class="form-text">ISO 3166-1 alpha-2 –∫–æ–¥ (2 –±—É–∫–≤—ã)</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º *</label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           placeholder="–†–æ—Å—Å–∏—è, –ì–µ—Ä–º–∞–Ω–∏—è, –°–®–ê...">
                                    <div class="form-text">–ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="name_en" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º</label>
                                    <input type="text" class="form-control" id="name_en" name="name_en"
                                           placeholder="Russia, Germany, USA...">
                                    <div class="form-text">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="flag_emoji" class="form-label">–§–ª–∞–≥ (—ç–º–æ–¥–∑–∏) *</label>
                                    <input type="text" class="form-control" id="flag_emoji" name="flag_emoji" 
                                           maxlength="10" required
                                           placeholder="üá∑üá∫, üá©üá™, üá∫üá∏...">
                                    <div class="form-text">–§–ª–∞–≥ —Å—Ç—Ä–∞–Ω—ã –≤ –≤–∏–¥–µ —ç–º–æ–¥–∑–∏</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="priority" class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                                    <input type="number" class="form-control" id="priority" name="priority" 
                                           value="100" min="1" max="999">
                                    <div class="form-text">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–≤—ã—à–µ = —Ä–∞–Ω—å—à–µ –≤ —Å–ø–∏—Å–∫–µ)</div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h6>
                                            <div id="preview" class="d-flex align-items-center">
                                                <span id="previewFlag" class="me-2 fs-4">üåç</span>
                                                <div>
                                                    <div id="previewName" class="fw-bold">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã</div>
                                                    <small id="previewCode" class="text-muted">–ö–û–î</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12">
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <a href="/admin/countries" class="btn btn-secondary">
                                        <i class="bi bi-arrow-left"></i> –û—Ç–º–µ–Ω–∞
                                    </a>
                                    <button type="submit" class="btn btn-success">
                                        <i class="bi bi-check-circle"></i> –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω—É
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –ü—Ä–µ–≤—å—é –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function updatePreview() {
    const flag = document.getElementById('flag_emoji').value || 'üåç';
    const name = document.getElementById('name').value || '–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã';
    const code = document.getElementById('code').value.toUpperCase() || '–ö–û–î';
    
    document.getElementById('previewFlag').textContent = flag;
    document.getElementById('previewName').textContent = name;
    document.getElementById('previewCode').textContent = code;
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é
document.getElementById('flag_emoji').addEventListener('input', updatePreview);
document.getElementById('name').addEventListener('input', updatePreview);
document.getElementById('code').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
    updatePreview();
});

// –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã - –±—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä
const popularCountries = [
    { code: 'US', name: '–°–®–ê', name_en: 'United States', flag: 'üá∫üá∏' },
    { code: 'FR', name: '–§—Ä–∞–Ω—Ü–∏—è', name_en: 'France', flag: 'üá´üá∑' },
    { code: 'GB', name: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', name_en: 'United Kingdom', flag: 'üá¨üáß' },
    { code: 'JP', name: '–Ø–ø–æ–Ω–∏—è', name_en: 'Japan', flag: 'üáØüáµ' },
    { code: 'CA', name: '–ö–∞–Ω–∞–¥–∞', name_en: 'Canada', flag: 'üá®üá¶' },
    { code: 'AU', name: '–ê–≤—Å—Ç—Ä–∞–ª–∏—è', name_en: 'Australia', flag: 'üá¶üá∫' }
];

// –î–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞
const quickSelectContainer = document.createElement('div');
quickSelectContainer.className = 'mb-3';
quickSelectContainer.innerHTML = `
    <label class="form-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</label>
    <div class="d-flex flex-wrap gap-2">
        ${popularCountries.map(country => `
            <button type="button" class="btn btn-sm btn-outline-primary" 
                    onclick="selectCountry('${country.code}', '${country.name}', '${country.name_en}', '${country.flag}')">
                ${country.flag} ${country.name}
            </button>
        `).join('')}
    </div>
`;

// –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø–æ–ª—è —Ñ–ª–∞–≥–∞
document.getElementById('flag_emoji').parentNode.parentNode.appendChild(quickSelectContainer);

function selectCountry(code, name, nameEn, flag) {
    document.getElementById('code').value = code;
    document.getElementById('name').value = name;
    document.getElementById('name_en').value = nameEn;
    document.getElementById('flag_emoji').value = flag;
    updatePreview();
}
</script>
{% endblock %} 