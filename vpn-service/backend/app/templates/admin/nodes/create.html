{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å VPN –ù–æ–¥—É | VPN Admin{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å VPN –ù–æ–¥—É</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="/admin/nodes" class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
        </div>
    </div>
</div>

{% if error %}
<div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}

<!-- Deployment Method Selection -->
<div class="card admin-card mb-4">
    <div class="card-header">
        <h5><i class="bi bi-gear me-2"></i>–°–ø–æ—Å–æ–± —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-12">
                <p class="mb-3">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–¥—ã:</p>
                <div class="row">
                    <!-- Manual Configuration -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 deployment-method-card" data-method="manual">
                            <div class="card-body text-center">
                                <i class="bi bi-gear-fill display-4 text-primary mb-3"></i>
                                <h5>üîß –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</h5>
                                <p class="text-muted">–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–¥—ã —Å –≥–æ—Ç–æ–≤–æ–π X3UI –ø–∞–Ω–µ–ª—å—é</p>
                                <span class="badge bg-primary">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SSH Automation -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 deployment-method-card" data-method="ssh">
                            <div class="card-body text-center">
                                <i class="bi bi-terminal-fill display-4 text-success mb-3"></i>
                                <h5>üîê SSH –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</h5>
                                <p class="text-muted">–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ SSH</p>
                                <span class="badge bg-success">–ë—ã—Å—Ç—Ä–æ ~5-10 –º–∏–Ω—É—Ç</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- X3UI Upload -->
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 deployment-method-card" data-method="x3ui_upload">
                            <div class="card-body text-center">
                                <i class="bi bi-cloud-upload-fill display-4 text-warning mb-3"></i>
                                <h5>üì§ X3UI –∑–∞–≥—Ä—É–∑–∫–∞</h5>
                                <p class="text-muted">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é X3UI –ø–∞–Ω–µ–ª—å</p>
                                <span class="badge bg-warning">–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å ~8-12 –º–∏–Ω—É—Ç</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Manual Configuration Form (Original) -->
<div class="card admin-card" id="manualForm" style="display: none;">
    <div class="card-header">
        <h5><i class="bi bi-gear me-2"></i>–†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–¥—ã</h5>
    </div>
    <div class="card-body">
        <form action="/admin/nodes/create" method="post" id="createNodeForm">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                    
                    <div class="mb-3">
                        <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–¥—ã *</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                        <div class="form-text">–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "VPN-EU-1")</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                        <div class="form-text">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–¥—ã –∏ –µ—ë –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="location" class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                        <select class="form-select" id="location" name="location" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                            {% if countries %}
                                {% for country in countries %}
                                    <option value="{{ country.name }}">
                                        {{ country.flag_emoji }} {{ country.name }}
                                    </option>
                                {% endfor %}
                            {% else %}
                                <option value="–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã">üá≥üá± –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã</option>
                                <option value="–ì–µ—Ä–º–∞–Ω–∏—è">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
                            {% endif %}
                        </select>
                        <div class="form-text">–°—Ç—Ä–∞–Ω–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è VPN –Ω–æ–¥—ã</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h5 class="mb-3"><i class="bi bi-gear me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ X3UI</h5>
                    
                    <div class="mb-3">
                        <label for="x3ui_url" class="form-label">URL X3UI –ø–∞–Ω–µ–ª–∏ *</label>
                        <input type="url" class="form-control" id="x3ui_url" name="x3ui_url" required>
                        <div class="form-text">–ü–æ–ª–Ω—ã–π URL —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –∏ –ø–æ—Ä—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "https://server.com:2053")</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="x3ui_username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
                        <input type="text" class="form-control" id="x3ui_username" name="x3ui_username" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="x3ui_password" class="form-label">–ü–∞—Ä–æ–ª—å *</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="x3ui_password" name="x3ui_password" required>
                            <button class="btn btn-outline-secondary" type="button" id="showPassword">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</label>
                        <div>
                            <button type="button" class="btn btn-outline-primary btn-sm" id="testConnection">
                                <i class="bi bi-wifi"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
                            </button>
                            <span id="connectionStatus" class="ms-2"></span>
                        </div>
                        <div class="form-text">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º</div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-12">
                    <h5 class="mb-3"><i class="bi bi-diagram-3 me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</h5>
                </div>
                
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="max_users" class="form-label">–ú–∞–∫—Å–∏–º—É–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</label>
                        <input type="number" class="form-control" id="max_users" name="max_users" value="1000" min="1" max="10000">
                        <div class="form-text">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–¥–µ</div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="priority" class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                        <input type="number" class="form-control" id="priority" name="priority" value="100" min="1" max="1000">
                        <div class="form-text">–ß–µ–º –≤—ã—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏</div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="weight" class="form-label">–í–µ—Å</label>
                        <input type="number" class="form-control" id="weight" name="weight" value="1.0" min="0.1" max="10" step="0.1">
                        <div class="form-text">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –Ω–∞–≥—Ä—É–∑–∫–∏ (1.0 = —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, 0.5 = –ø–æ–ª–æ–≤–∏–Ω–∞)</div>
                    </div>
                </div>
            </div>

            <!-- Reality Configuration Section -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <h5 class="mb-3"><i class="bi bi-shield-check me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ VLESS-REALITY Inbound</h5>
                    <p class="text-muted">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Reality inbound'–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
                
                <div class="col-md-12">
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="create_inbound" name="create_inbound" checked>
                            <label class="form-check-label" for="create_inbound">
                                <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å Reality inbound</strong>
                            </label>
                        </div>
                        <div class="form-text">
                            <i class="bi bi-info-circle me-1"></i>
                            –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VLESS-REALITY. 
                            –ë–µ–∑ inbound'–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å VPN –∫–ª—é—á–∏.
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6" id="realitySettings">
                    <div class="mb-3">
                        <label for="reality_port" class="form-label">–ü–æ—Ä—Ç VPN</label>
                        <input type="number" class="form-control" id="reality_port" name="reality_port" value="443" min="1" max="65535">
                        <div class="form-text">–ü–æ—Ä—Ç –¥–ª—è VLESS-REALITY —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 443)</div>
                    </div>
                </div>
                
                <div class="col-md-6" id="sniSettings">
                    <div class="mb-3">
                        <label for="sni_mask" class="form-label">SNI –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞</label>
                        <select class="form-select" id="sni_mask" name="sni_mask">
                            <option value="apple.com" selected>apple.com (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                            <option value="google.com">google.com</option>
                            <option value="microsoft.com">microsoft.com</option>
                            <option value="cloudflare.com">cloudflare.com</option>
                            <option value="github.com">github.com</option>
                            <option value="amazon.com">amazon.com</option>
                        </select>
                        <div class="form-text">–î–æ–º–µ–Ω –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ VLESS-REALITY —Ç—Ä–∞—Ñ–∏–∫–∞</div>
                    </div>
                </div>
                
                <div class="col-md-12">
                    <div class="alert alert-info" role="alert">
                        <i class="bi bi-lightbulb me-2"></i>
                        <strong>Reality inbound –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç:</strong>
                        <ul class="mb-0 mt-2">
                            <li>X25519 –∫–ª—é—á–∏ –¥–ª—è Reality —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</li>
                            <li>TCP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç —Å Reality security</li>
                            <li>Chrome fingerprint –¥–ª—è –ª—É—á—à–µ–π –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏</li>
                            <li>–ì–æ—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <a href="/admin/nodes" class="btn btn-secondary me-md-2">
                    <i class="bi bi-x-lg me-1"></i>–û—Ç–º–µ–Ω–∞
                </a>
                <button type="submit" class="btn btn-primary" id="createBtn">
                    <i class="bi bi-plus-circle me-1"></i>–°–æ–∑–¥–∞—Ç—å –Ω–æ–¥—É
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Automated Deployment Form -->
<div class="card admin-card" id="automatedForm" style="display: none;">
    <div class="card-header">
        <h5><i class="bi bi-robot me-2"></i>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–æ–¥—ã</h5>
    </div>
    <div class="card-body">
        <form id="automatedNodeForm">
            <!-- Basic Information -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5 class="mb-3"><i class="bi bi-globe me-2"></i>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                    
                    <div class="mb-3">
                        <label for="auto_domain" class="form-label">–î–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ *</label>
                        <input type="text" class="form-control" id="auto_domain" name="domain" required>
                        <div class="form-text">–î–æ–º–µ–Ω –¥–ª—è VPN –Ω–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, node1.example.com)</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="auto_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–¥—ã</label>
                        <input type="text" class="form-control" id="auto_name" name="name">
                        <div class="form-text">–ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="auto_location" class="form-label">–õ–æ–∫–∞—Ü–∏—è</label>
                        <input type="text" class="form-control" id="auto_location" name="location">
                        <div class="form-text">–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–±—É–¥–µ—Ç –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ)</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <h5 class="mb-3"><i class="bi bi-gear me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ SSL –∏ –ø–æ—Ä—Ç–∞</h5>
                    
                    <div class="mb-3">
                        <label for="auto_ssl_email" class="form-label">Email –¥–ª—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</label>
                        <input type="email" class="form-control" id="auto_ssl_email" name="ssl_email">
                        <div class="form-text">Email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —á–µ—Ä–µ–∑ Let's Encrypt</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="auto_custom_port" class="form-label">–ü–æ—Ä—Ç VPN</label>
                        <input type="number" class="form-control" id="auto_custom_port" name="custom_port" value="443" min="1" max="65535">
                        <div class="form-text">–ü–æ—Ä—Ç –¥–ª—è VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 443)</div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="auto_enable_monitoring" name="enable_monitoring" checked>
                            <label class="form-check-label" for="auto_enable_monitoring">
                                –í–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="auto_add_to_balancer" name="auto_add_to_balancer" checked>
                            <label class="form-check-label" for="auto_add_to_balancer">
                                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Deployment Method Specific Settings -->
            <div class="row mb-4" id="sshSettings" style="display: none;">
                <div class="col-md-12">
                    <h5 class="mb-3"><i class="bi bi-terminal me-2"></i>SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="ssh_host" class="form-label">SSH —Ö–æ—Å—Ç</label>
                        <input type="text" class="form-control" id="ssh_host" name="ssh_host">
                        <div class="form-text">IP –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞ (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞)</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="ssh_user" class="form-label">SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" class="form-control" id="ssh_user" name="ssh_user" value="root">
                        <div class="form-text">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">–°–ø–æ—Å–æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ SSH</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="ssh_auth_method" id="ssh_password_auth" value="password" checked>
                            <label class="form-check-label" for="ssh_password_auth">
                                –ü–∞—Ä–æ–ª—å
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="ssh_auth_method" id="ssh_key_auth" value="key">
                            <label class="form-check-label" for="ssh_key_auth">
                                SSH –∫–ª—é—á
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3" id="ssh_password_field">
                        <label for="ssh_password" class="form-label">SSH –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="ssh_password" name="ssh_password">
                    </div>
                    
                    <div class="mb-3" id="ssh_key_field" style="display: none;">
                        <label for="ssh_key_path" class="form-label">–ü—É—Ç—å –∫ SSH –∫–ª—é—á—É</label>
                        <input type="text" class="form-control" id="ssh_key_path" name="ssh_key_path">
                        <div class="form-text">–ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É SSH –∫–ª—é—á—É</div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4" id="x3uiSettings" style="display: none;">
                <div class="col-md-12">
                    <h5 class="mb-3"><i class="bi bi-cloud-upload me-2"></i>X3UI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="auto_x3ui_url" class="form-label">URL X3UI –ø–∞–Ω–µ–ª–∏</label>
                        <input type="url" class="form-control" id="auto_x3ui_url" name="x3ui_url">
                        <div class="form-text">URL —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π X3UI –ø–∞–Ω–µ–ª–∏</div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="auto_x3ui_username" class="form-label">X3UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" class="form-control" id="auto_x3ui_username" name="x3ui_username">
                    </div>
                    
                    <div class="mb-3">
                        <label for="auto_x3ui_password" class="form-label">X3UI –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-control" id="auto_x3ui_password" name="x3ui_password">
                    </div>
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button type="button" class="btn btn-outline-secondary me-md-2" id="validateConfig">
                    <i class="bi bi-check-circle me-1"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
                </button>
                <button type="button" class="btn btn-outline-primary me-md-2" id="generateScript" style="display: none;">
                    <i class="bi bi-file-earmark-code me-1"></i>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
                </button>
                <a href="/admin/nodes" class="btn btn-secondary me-md-2">
                    <i class="bi bi-x-lg me-1"></i>–û—Ç–º–µ–Ω–∞
                </a>
                <button type="submit" class="btn btn-success" id="startDeployment">
                    <i class="bi bi-play-circle me-1"></i>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Progress Tracking Modal -->
<div class="modal fade" id="deploymentModal" tabindex="-1" aria-labelledby="deploymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deploymentModalLabel">
                    <i class="bi bi-gear-fill me-2"></i>–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–æ–¥—ã
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-2">
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" 
                             role="progressbar" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <strong>–¢–µ–∫—É—â–∏–π —à–∞–≥:</strong> <span id="currentStep">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-list-ul me-2"></i>–õ–æ–≥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="deploymentLogs" style="max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.9rem;">
                            <!-- Logs will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div id="deploymentError" class="alert alert-danger mt-3" style="display: none;">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <span id="errorMessage"></span>
                </div>
                
                <div id="deploymentSuccess" class="alert alert-success mt-3" style="display: none;">
                    <i class="bi bi-check-circle me-2"></i>
                    –ù–æ–¥–∞ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞! <a href="/admin/nodes" id="successNodeLink">–ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –Ω–æ–¥–∞–º–∏</a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="closeDeploymentModal">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button type="button" class="btn btn-primary" id="downloadScript" style="display: none;">
                    <i class="bi bi-download me-1"></i>–°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Information Cards -->
<div class="card admin-card mt-4">
    <div class="card-header">
        <h5><i class="bi bi-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–¥—ã</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <div id="manualInfo">
                    <p class="mb-3">–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–¥—ã —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:</p>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ X3UI –ø–∞–Ω–µ–ª–∏</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç –∑–¥–æ—Ä–æ–≤—å–µ –Ω–æ–¥—ã</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–î–æ–±–∞–≤–∏—Ç –Ω–æ–¥—É –≤ –ø—É–ª –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ù–∞—á–Ω–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–æ–¥—ã</li>
                    </ul>
                </div>
                
                <div id="automatedInfo" style="display: none;">
                    <p class="mb-3">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç:</p>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Xray</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π–µ—Ä–≤–æ–ª–∞ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</li>
                        <li class="mb-2"><i class="bi bi-check-circle text-success me-2"></i>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</li>
                    </ul>
                </div>
                
                <p class="text-muted">
                    –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏ 
                    –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏ —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏.
                </p>
            </div>
            <div class="col-md-4">
                <div class="alert alert-info">
                    <h6><i class="bi bi-lightbulb me-1"></i>–°–æ–≤–µ—Ç—ã:</h6>
                    <ul class="small mb-0">
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</li>
                        <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π</li>
                        <li>–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–æ–¥</li>
                        <li>–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedDeploymentMethod = null;
let currentDeploymentId = null;

// Deployment method selection
document.addEventListener('DOMContentLoaded', function() {
    const methodCards = document.querySelectorAll('.deployment-method-card');
    const manualForm = document.getElementById('manualForm');
    const automatedForm = document.getElementById('automatedForm');
    const manualInfo = document.getElementById('manualInfo');
    const automatedInfo = document.getElementById('automatedInfo');
    
    methodCards.forEach(card => {
        card.addEventListener('click', function() {
            // Remove active class from all cards
            methodCards.forEach(c => c.classList.remove('border-primary', 'shadow'));
            
            // Add active class to clicked card
            this.classList.add('border-primary', 'shadow');
            
            selectedDeploymentMethod = this.dataset.method;
            
            // Show appropriate form
            if (selectedDeploymentMethod === 'manual') {
                manualForm.style.display = 'block';
                automatedForm.style.display = 'none';
                manualInfo.style.display = 'block';
                automatedInfo.style.display = 'none';
            } else {
                manualForm.style.display = 'none';
                automatedForm.style.display = 'block';
                manualInfo.style.display = 'none';
                automatedInfo.style.display = 'block';
                
                // Show method-specific settings
                showMethodSettings(selectedDeploymentMethod);
            }
        });
    });
    
    // SSH auth method toggle
    const authRadios = document.querySelectorAll('input[name="ssh_auth_method"]');
    authRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            const passwordField = document.getElementById('ssh_password_field');
            const keyField = document.getElementById('ssh_key_field');
            
            if (this.value === 'password') {
                passwordField.style.display = 'block';
                keyField.style.display = 'none';
            } else {
                passwordField.style.display = 'none';
                keyField.style.display = 'block';
            }
        });
    });
    
    // Auto-fill domain-based fields
    const domainField = document.getElementById('auto_domain');
    if (domainField) {
        domainField.addEventListener('input', function() {
            const domain = this.value;
            if (domain) {
                // Auto-fill related fields
                document.getElementById('auto_ssl_email').value = `admin@${domain}`;
                document.getElementById('auto_x3ui_url').value = `https://${domain}:2053`;
                document.getElementById('ssh_host').value = domain;
                
                if (!document.getElementById('auto_name').value) {
                    document.getElementById('auto_name').value = `node-${domain.split('.')[0]}`;
                }
            }
        });
    }
});

function showMethodSettings(method) {
    const sshSettings = document.getElementById('sshSettings');
    const x3uiSettings = document.getElementById('x3uiSettings');
    const generateScriptBtn = document.getElementById('generateScript');
    
    // Hide all method-specific settings
    sshSettings.style.display = 'none';
    x3uiSettings.style.display = 'none';
    generateScriptBtn.style.display = 'none';
    
    // Show relevant settings
    if (method === 'ssh') {
        sshSettings.style.display = 'block';
    } else if (method === 'x3ui_upload') {
        x3uiSettings.style.display = 'block';
    } else if (method === 'manual') {
        generateScriptBtn.style.display = 'inline-block';
    }
}

// Validate configuration
document.getElementById('validateConfig').addEventListener('click', async function() {
    const form = document.getElementById('automatedNodeForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Add deployment method
    data.deployment_method = selectedDeploymentMethod;
    
    try {
        const response = await fetch('/admin/nodes/api/validate-deployment-config', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            adminUtils.showToast('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞! –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ.', 'success');
            
            // Apply recommendations
            if (result.recommendations) {
                Object.keys(result.recommendations).forEach(key => {
                    const field = document.querySelector(`[name="${key}"]`);
                    if (field && !field.value && result.recommendations[key]) {
                        field.value = result.recommendations[key];
                    }
                });
            }
        } else {
            const errorMsg = result.errors ? result.errors.join('\n') : 'Validation failed';
            adminUtils.showToast(`–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:\n${errorMsg}`, 'error');
        }
    } catch (error) {
        adminUtils.showToast('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ' + error.message, 'error');
    }
});

// Generate installation script
document.getElementById('generateScript').addEventListener('click', async function() {
    const form = document.getElementById('automatedNodeForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    try {
        const response = await fetch('/admin/nodes/api/generate-installer-script', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            // Download script
            const blob = new Blob([result.script_content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = result.script_filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            adminUtils.showToast('–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω!', 'success');
        } else {
            adminUtils.showToast('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞: ' + result.error, 'error');
        }
    } catch (error) {
        adminUtils.showToast('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞: ' + error.message, 'error');
    }
});

// Start automated deployment
document.getElementById('startDeployment').addEventListener('click', async function(e) {
    e.preventDefault();
    
    const form = document.getElementById('automatedNodeForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Add deployment method
    data.deployment_method = selectedDeploymentMethod;
    
    // Add checkbox values
    data.enable_monitoring = document.getElementById('auto_enable_monitoring').checked;
    data.auto_add_to_balancer = document.getElementById('auto_add_to_balancer').checked;
    
    try {
        const response = await fetch('/admin/nodes/api/auto-deploy', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            currentDeploymentId = result.deployment_id;
            
            // Show deployment modal
            const modal = new bootstrap.Modal(document.getElementById('deploymentModal'));
            modal.show();
            
            // Start progress tracking
            trackDeploymentProgress();
            
            adminUtils.showToast('–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ!', 'success');
        } else {
            adminUtils.showToast('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: ' + result.error, 'error');
        }
    } catch (error) {
        adminUtils.showToast('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è: ' + error.message, 'error');
    }
});

// Track deployment progress
async function trackDeploymentProgress() {
    if (!currentDeploymentId) return;
    
    try {
        const response = await fetch(`/admin/nodes/api/deployment-progress/${currentDeploymentId}`);
        const result = await response.json();
        
        if (result.success && result.progress) {
            const progress = result.progress;
            
            // Update progress bar
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            progressBar.style.width = progress.progress_percent + '%';
            progressPercent.textContent = progress.progress_percent + '%';
            
            // Update current step
            document.getElementById('currentStep').textContent = progress.current_step;
            
            // Update logs
            const logsContainer = document.getElementById('deploymentLogs');
            if (progress.logs && progress.logs.length > 0) {
                const latestLogs = progress.logs.slice(-5); // Show last 5 logs
                logsContainer.innerHTML = latestLogs.map(log => 
                    `<div class="mb-1"><small class="text-muted">[${log.timestamp}]</small> ${log.message}</div>`
                ).join('');
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }
            
            // Handle completion states
            if (progress.status === 'completed') {
                progressBar.classList.remove('progress-bar-animated');
                progressBar.classList.add('bg-success');
                document.getElementById('deploymentSuccess').style.display = 'block';
                
                if (progress.node_id) {
                    document.getElementById('successNodeLink').href = `/admin/nodes/${progress.node_id}`;
                }
                
                adminUtils.showToast('–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!', 'success');
                return; // Stop tracking
            } else if (progress.status === 'failed') {
                progressBar.classList.remove('progress-bar-animated');
                progressBar.classList.add('bg-danger');
                document.getElementById('deploymentError').style.display = 'block';
                document.getElementById('errorMessage').textContent = progress.error || 'Unknown error';
                
                adminUtils.showToast('–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å —Å –æ—à–∏–±–∫–æ–π', 'error');
                return; // Stop tracking
            }
            
            // Continue tracking if still in progress
            setTimeout(trackDeploymentProgress, 2000); // Check every 2 seconds
        }
    } catch (error) {
        console.error('Error tracking deployment progress:', error);
        setTimeout(trackDeploymentProgress, 5000); // Retry in 5 seconds
    }
}

// Original manual form functionality
// Show/hide password
document.getElementById('showPassword').addEventListener('click', function() {
    const passwordField = document.getElementById('x3ui_password');
    const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordField.setAttribute('type', type);
    this.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
});

// Test connection
document.getElementById('testConnection').addEventListener('click', function() {
    const statusElement = document.getElementById('connectionStatus');
    const button = this;
    const url = document.getElementById('x3ui_url').value;
    const username = document.getElementById('x3ui_username').value;
    const password = document.getElementById('x3ui_password').value;
    
    if (!url || !username || !password) {
        adminUtils.showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è X3UI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'warning');
        return;
    }
    
    button.disabled = true;
    button.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>–ü—Ä–æ–≤–µ—Ä–∫–∞...';
    statusElement.innerHTML = '';
    
    // Test connection API call would go here
    setTimeout(() => {
        button.disabled = false;
        button.innerHTML = '<i class="bi bi-wifi"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ';
        statusElement.innerHTML = '<span class="text-success"><i class="bi bi-check-circle"></i> –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ</span>';
    }, 2000);
});

// Utility functions for UI feedback
const adminUtils = {
    showToast: function(message, type = 'info') {
        // Simple toast implementation (you can replace with your preferred toast library)
        const toastContainer = document.createElement('div');
        toastContainer.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
        toastContainer.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
        toastContainer.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(toastContainer);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            if (toastContainer.parentNode) {
                toastContainer.remove();
            }
        }, 5000);
    }
};
</script>

<style>
.deployment-method-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.deployment-method-card:hover {
    border-color: #0d6efd;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.deployment-method-card.border-primary {
    border-color: #0d6efd !important;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

#deploymentLogs {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 0.5rem;
}

.alert.position-fixed {
    animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
</style>
{% endblock %} 